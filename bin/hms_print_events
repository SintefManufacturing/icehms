#!/usr/bin/python

import sys

from icehms import IceManager, Holon, run_holon

class Client(Holon):
    def __init__(self, tn):
        Holon.__init__(self )
        print("Monitoring: ", tn)
        self._tn = tn

    def run(self):
        self._subscribe_topic(self._tn)

    def put_message(self, msg, ctx=None):
        print("New Message: ", msg) 

def print_topics():
    mgr = IceManager()
    mgr.init()
    try:
        topics = mgr.get_all_topics()
        print("Events Topics are: \n")
        for name, prx in topics.items():
            print(name)
    finally:
        mgr.shutdown()


if __name__ == "__main__":
    if len(sys.argv) > 1:
        topicname = sys.argv[1]
    else:
        print("Usage: ", sys.argv[0], " TopicName")
        print("")
        print_topics()
        sys.exit(0)

    s = Client(topicname)
    run_holon(s)
